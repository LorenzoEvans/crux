1580838689059:(ns crux-app.core)
1580838691793:(crux)
1580838706721:(require '[crux.core :as crux])
1580838734794:(require [crux.core :as crux])
1580838747074:(require [crux.api :as crux])
1580838778787:(require '[crux.api :as crux])
1580838828008:(crux)
1580838875962::repl/quit
1580838918241:(require '[crux.api :as crux])
1580838973966:(def crux\n  (crux/start-node\n    {:crux.node/topology :crux.standalone/topology\n     :crux.node/kv-store "crux.kv.membd/kv"\n     :crux.standalone/event-log-dir "data/eventlog-1"\n     :crux.kv/db-dir "data/db-dir"\n     :crux.standalone/event-log-kv-store "crux.kv.memdb/kv"}))
1580839021798:(def crux\n  (crux/start-node\n       {:crux.node/topology :crux.standalone/topology\n        :crux.node/kv-store "crux.kv.memdb/kv"\n        :crux.standalone/event-log-dir "data/eventlog-1"\n        :crux.kv/db-dir "data/db-dir"\n        :crux.standalone/event-log-kv-store "crux.kv.memdb/kv"}))
1580839154578:(def manifest \n  {:crux.db/id :manifest\n   :pilot-name "Lorenzo"\n   :id/rocket "SB002-sol"\n   :id/employee "22910x2"\n   :badges "SETUP"\n   :cargo ["stereo" "gold fish" "slippers" "secret note"]})
1580843064014:(crux/submit-tx crux [[:crux.tx/put manifest]])
1580843095718:(crux/entity\n (crux/db crux) :manifest)
1580844694954:(crux/submit-tx crux\n  [[:crux.tx/put\n    {:crux.db/id :commodity/Pu\n     :common-name "Plutonium"\n     :type :element/metal\n     :density 19.816\n     :radioactive true}]\n   [:crux.tx/put\n     {:crux.db/id :commodity/N\n      :common-name "Nitrogen"\n      :type :element/gas\n      :density 1.2506\n      :radioactive false}]\n   [:crux.tx/put\n      {:crux.db/id :commodity/CH4\n       :common-name "Methane"\n       :type :molecule/gas\n       :density 0.717\n       :radioactive false}]])
1580845073241:(crux/submit-tx crux\n                [[:crux.tx/put\n                  {:crux.db/id :stock/Pu\n                   :commod :commodity/Pu\n                   :weight-ton 21}\n                  #inst "2115-02-13T18"] ;; valid-time\n\n                 [:crux.tx/put\n                  {:crux.db/id :stock/Pu\n                   :commod :commodity/Pu\n                   :weight-ton 23}\n                  #inst "2115-02-14T18"]\n\n                 [:crux.tx/put\n                  {:crux.db/id :stock/Pu\n                   :commod :commodity/Pu\n                   :weight-ton 22.2}\n                  #inst "2115-02-15T18"]\n\n                 [:crux.tx/put\n                  {:crux.db/id :stock/Pu\n                   :commod :commodity/Pu\n                   :weight-ton 24}\n                  #inst "2115-02-18T18"]\n\n                 [:crux.tx/put\n                  {:crux.db/id :stock/Pu\n                   :commod :commodity/Pu\n                   :weight-ton 24.9}\n                  #inst "2115-02-19T18"]])
1580845083096:(crux/submit-tx crux\n                [[:crux.tx/put\n                  {:crux.db/id :stock/N\n                   :commod :commodity/N\n                   :weight-ton 3}\n                  #inst "2115-02-13T18" ;; start valid-time\n                  #inst "2115-02-19T18"] ;; end valid-time\n\n                 [:crux.tx/put\n                  {:crux.db/id :stock/CH4\n                   :commod :commodity/CH4\n                   :weight-ton 92}\n                  #inst "2115-02-15T18"\n                  #inst "2115-02-19T18"]])
1580845566265:(crux/entity (crux/db crux #inst "2115-02-14") :stock/Pu)
1580845576062:(crux/entity (crux/db crux #inst "2115-02-18") :stock/Pu)
1580845584654:(crux/entity (crux/db crux #inst "2115-02-18") :stock/CH4)
1580845741835:(defn easy-ingest\n  "Uses crux put tx to add a vector of docs to specific node."\n  [node docs]\n  (crux/submit-tx node\n    (vec (for [doc docs]\n          [:crux.tx/put doc]))))
1580845825599:(crux/submit-tx crux\n  ([[:crux.tx/put (assoc manifest :badges ["SETUP" "PUT"])]]))
1580845955536:(crux/submit-tx crux\n  [[:crux.tx/put (assoc manifest :badges ["SETUP" "PUT"])]])
1580845976534:(crux/entity (crux/db crux) :manifest)
1580851885423:(easy-ingest crux\n             [{:crux.db/id :commodity/Pu\n               :common-name "Plutonium"\n               :type :element/metal\n               :density 19.816\n               :radioactive true}\n              {:crux.db/id :commodity/N\n               :common-name "Nitrogen"\n               :type :element/gas\n               :density 1.2596\n               :radioactive false}\n              {:crux.db/id :commodity/CH4\n               :common-name "Methane"\n               :type :element/gas\n               :density 0.717\n               :radioactive false}\n              {:crux.db/id :commodity/Au\n               :common-name "Gold"\n               :type :element/metal\n               :density 19.300\n               :radioactive false}\n              {:crux.db/id :commodity/C\n               :common-name "Carbon"\n               :type :element/non-metal\n               :density 2.267\n               :radioactive false}\n              {:crux.db/id :commodity/borax\n               :common-name "Borax"\n               :IUPAC-name "Sodium tetraborate decahydrate"\n               :other-names ["Borax decahydrate" "sodium borate" "sodium tetraborate" "disodium tetraborate"]\n               :type :mineral/solid\n               :appearance "white solid"\n               :density 1.73\n               :radioactive false}])
1580852537705:(crux/q (crux/db crux)\n        '{:find [element]\n          :where [[element :type :element/metal]]})
1580853409350:(=\n (crux/q (crux/db crux)\n         '{:find [element]\n           :where [[element :type :element/metal]]})\n (crux/q (crux/db crux)\n         '{:find [element]\n           :where [[element :type :element/metal]]})\n (crux/q (crux/db crux)\n         '{:find [element]\n           :where [[element :type :element/metal]]}))
1580855899872:(crux/q (crux/db crux)\n        '{:find [name]\n          :where [[e :type :element/metal]\n                  [e :common-name name]]])
1580855914049:(crux/q (crux/db crux)\n        '{:find [name]\n          :where [[e :type :element/metal]\n                  [e :common-name name]]]})
1580855942314:(crux/q (crux/db crux)\n        '{:find [name]\n          :where [[e :type :element/metal]\n                  [e :common-name name]]})
1580866212074:(crux/q (crux/db crux)\n        '{:find [name rho]\n          :where [[e :density rho]\n                  [e :common-name name]]})
1580866275016:(crux/q (crux/db crux)\n        {:find '[name]\n         :where '[[e :type t]\n                  [e :common-name name]]\n         :args [{'t :element/metal}]})
1580866566329:(defn filter-type \n  [type]\n  (crux/q (crux/db crux)\n        {:find '[name]\n         :where '[[e :type t]\n                  [e :common-name name]]\n         :args [{'t type}]}))
1580866573478:(defn filter-appearance\n  [description]\n  (crux/q (crux/db crux)\n        {:find '[name IUPAC]\n         :where '[[e :common-name name]\n                  [e :IUPAC-name IUPAC]\n                  [e :appearance appearance]]\n         :args [{'appearance description}]}))
1580866592142:(filter-type :element/metal)
1580866603749:(filter-appearance "white solid")
1580866663777:(crux/submit-tx crux\n                [[:crux.tx/put\n                  (assoc manifest :badges ["SETUP" "PUT" "DATALOG-QUERIES"])]])
1580938181324:(crux/submit-tx crux\n                [[:crux.tx/put\n                  {:crux.db/id :consumer/RJ29sUU\n                   :first-name "Jay"\n                   :last-name "Rose"\n                   :cover? true\n                   :cover-type :Full}\n                  #inst "2114-12-03"]])
1580938220960:(crux/submit-tx\n crux\n [[:crux.tx/put \n   {:crux.db/id :consumer/RJ29sUU\n    :consumer-id :RJ29sUU\n    :first-name "Jay"\n    :last-name "Rose"\n    :cover? true\n    :cover-type :Full}\n   #inst "2113-12-03" ;; Valid time start\n   #inst "2114-12-03"] ;; Valid time end\n\n  [:crux.tx/put \n   {:crux.db/id :consumer/RJ29sUU\n    :consumer-id :RJ29sUU\n    :first-name "Jay"\n    :last-name "Rose"\n    :cover? true\n    :cover-type :Full}\n   #inst "2112-12-03"\n   #inst "2113-12-03"]\n\n  [:crux.tx/put \n   {:crux.db/id :consumer/RJ29sUU\n    :consumer-id :RJ29sUU\n    :first-name "Jay"\n    :last-name "Rose"\n    :cover? false}\n   #inst "2112-06-03"\n   #inst "2112-12-02"]\n\n  [:crux.tx/put \n   {:crux.db/id :consumer/RJ29sUU\n    :consumer-id :RJ29sUU\n    :first-name "Jay"\n    :last-name "Rose"\n    :cover? true\n    :cover-type :Promotional}\n   #inst "2111-06-03"\n   #inst "2112-06-03"]])
1580938302805:(crux/q (crux/db crux #inst "2115-07-03")\n        '{:find [cover type]\n          :where [[e :consumer-id :RJ29sUU\n                  [e :cover? cover]\n                  [e :cover-type type]]})
1580938310908:(crux/q (crux/db crux #inst "2115-07-03")\n        '{:find [cover type]\n          :where [[e :consumer-id :RJ29sUU]\n                  [e :cover? cover]\n                  [e :cover-type type]]})
1580938368146:(crux/submit-tx\n crux\n [[:crux.tx/put\n   {:crux.db/id :consumer/RJ29sUU\n    :consumer-id :RJ29sUU\n    :first-name "Jay"\n    :last-name "Rose"\n    :cover? true\n    :cover-type :Full}\n   #inst "2114-12-03"]])
1580938387361:(crux/q (crux/db crux #inst "2115-07-03")\n        '{:find [cover type]\n          :where [[e :consumer-id :RJ29sUU]\n                  [e :cover? cover]\n                  [e :cover-type type]]})
1580938398784:(crux/q (crux/db crux #inst "2112-07-03")\n        '{:find [cover type]\n          :where [[e :consumer-id :RJ29sUU]\n                  [e :cover? cover]\n                  [e :cover-type type]]})
1580938418776:(crux/submit-tx\n crux\n [[:crux.tx/put\n   (assoc manifest :badges ["SETUP" "PUT" "DATALOG-QUERIES" "BITEMP"])]])
1580938498173:(easy-ingest \n )
1580938509358:(easy-ingest crux\n             [{:crux.db/id :gold-harmony\n    :company-name "Gold Harmony"\n    :seller? true\n    :buyer? false\n    :units/Au 10211\n    :credits 51}\n\n   {:crux.db/id :tombaugh-resources\n    :company-name "Tombaugh Resources Ltd."\n    :seller? true\n    :buyer? false\n    :units/Pu 50\n    :units/N 3\n    :units/CH4 92\n    :credits 51}\n\n   {:crux.db/id :encompass-trade\n    :company-name "Encompass Trade"\n    :seller? true\n    :buyer? true\n    :units/Au 10\n    :units/Pu 5\n    :units/CH4 211\n    :credits 1002}\n\n   {:crux.db/id :blue-energy\n    :seller? false\n    :buyer? true\n    :company-name "Blue Energy"\n    :credits 1000}])
1580938668429:(defn stock-check\n  [company-id item]\n  {:result (crux/q (crux/db crux)\n                   {:find '[name funds stock]\n                    :where ['[e :company-name name]\n                            '[e :credits funds]\n                            ['e item 'stock]]\n                    :args [{'e item 'stock}]})})
1580938758995:(defn stock-check\n  [company-id item]\n  {:result (crux/q (crux/db crux)\n                   {:find '[name funds stock]\n                    :where ['[e :company-name name]\n                            '[e :credits funds]\n                            ['e item 'stock]]\n                    :args [{'e company-id}]})\n   :item item})
1580944907778:(defn format-stock-check\n  [{:keys [result item] :as stock-check}]\n  (for [[name funds commod] result]\n    (str "Name: " name ", Funds: " funds ", " item " " commod)))
1580944926680:(crux/submit-tx\n crux\n [[:crux.tx/cas\n   ;; Old doc\n   {:crux.db/id :blue-energy\n    :seller? false\n    :buyer? true\n    :company-name "Blue Energy"\n    :credits 1000}\n   ;; New doc\n   {:crux.db/id :blue-energy\n    :seller? false\n    :buyer? true\n    :company-name "Blue Energy"\n    :credits 900\n    :units/CH4 10}]\n\n  [:crux.tx/cas\n   ;; Old doc\n   {:crux.db/id :tombaugh-resources\n    :company-name "Tombaugh Resources Ltd."\n    :seller? true\n    :buyer? false\n    :units/Pu 50\n    :units/N 3\n    :units/CH4 92\n    :credits 51}\n   ;; New doc\n   {:crux.db/id :tombaugh-resources\n    :company-name "Tombaugh Resources Ltd."\n    :seller? true\n    :buyer? false\n    :units/Pu 50\n    :units/N 3\n    :units/CH4 82\n    :credits 151}]])
1580944958046:(format-stock-check (stock-check) :tombaugh-resources :units/CH4)
1580944977908:(format-stock-check (stock-check :tombaugh-resources :units/CH4))
1580944995731:(format-stock-check (stock-check :blue-energy\n                                 :units/CH4))
1580945015440:(crux/submit-tx\n crux\n [[:crux.tx/cas\n   ;; Old doc\n   {:crux.db/id :gold-harmony\n    :company-name "Gold Harmony"\n    :seller? true\n    :buyer? false\n    :units/Au 10211\n    :credits 51}\n   ;; New doc\n   {:crux.db/id :gold-harmony\n    :company-name "Gold Harmony"\n    :seller? true\n    :buyer? false\n    :units/Au 211\n    :credits 51}]\n\n  [:crux.tx/cas\n   ;; Old doc\n   {:crux.db/id :encompass-trade\n    :company-name "Encompass Trade"\n    :seller? true\n    :buyer? true\n    :units/Au 10\n    :units/Pu 5\n    :units/CH4 211\n    :credits 100002}\n   ;; New doc\n   {:crux.db/id :encompass-trade\n    :company-name "Encompass Trade"\n    :seller? true\n    :buyer? true\n    :units/Au 10010\n    :units/Pu 5\n    :units/CH4 211\n    :credits 1002}]])
1580945068174:(format-stock-check (stock-check :gold-harmony :units/Au))
1580945085445:(format-stock-check (stock-check :encompass-trade :units/Au))
1580945104716:(crux/submit-tx\n crux\n [[:crux.tx/put\n   (assoc manifest :badges ["SETUP" "PUT" "DATALOG-QUERIES" "BITEMP" "CAS" ])]])
1580945137220:(crux/submit-tx crux\n                [[:crux.tx/put {:crux.db/id :kaarlang/clients\n                                :clients [:encompass-trade]}\n                  #inst "2110-01-01T09"\n                  #inst "2111-01-01T09"]\n\n                 [:crux.tx/put {:crux.db/id :kaarlang/clients\n                                :clients [:encompass-trade :blue-energy]}\n                  #inst "2111-01-01T09"\n                  #inst "2113-01-01T09"]\n\n                 [:crux.tx/put {:crux.db/id :kaarlang/clients\n                                :clients [:blue-energy]}\n                  #inst "2113-01-01T09"\n                  #inst "2114-01-01T09"]\n\n                 [:crux.tx/put {:crux.db/id :kaarlang/clients\n                                :clients [:blue-energy :gold-harmony :tombaugh-resources]}\n                  #inst "2114-01-01T09"\n                  #inst "2115-01-01T09"]])
1580945147362:(crux/history-ascending\n (crux/db crux)\n (crux/new-snapshot (crux/db crux #inst "2116-01-01T09")) \n :kaarlang/clients)
1580945165161:(crux/submit-tx crux\n                  [[:crux.tx/delete :kaarlang/clients #inst "2110-01-01" #inst "2116-01-01"]])
1580945202075:(crux/submit-tx crux\n                [[:crux.tx/put\n                  {:crux.db/id :person/kaarlang\n                   :full-name "Kaarlang"\n                   :origin-planet "Mars"\n                   :identity-tag :KA01299242093\n                   :DOB #inst "2040-11-23"}]\n\n                 [:crux.tx/put\n                  {:crux.db/id :person/ilex\n                   :full-name "Ilex Jefferson"\n                   :origin-planet "Venus"\n                   :identity-tag :IJ01222212454\n                   :DOB #inst "2061-02-17"}]\n\n                 [:crux.tx/put\n                  {:crux.db/id :person/thadd\n                   :full-name "Thad Christover"\n                   :origin-moon "Titan"\n                   :identity-tag :IJ01222212454\n                   :DOB #inst "2101-01-01"}]\n\n                 [:crux.tx/put\n                  {:crux.db/id :person/johanna\n                   :full-name "Johanna"\n                   :origin-planet "Earth"\n                   :identity-tag :JA012992129120\n                   :DOB #inst "2090-12-07"}]])
1580945224312:(defn full-query\n  [node]\n  (crux/q\n   (crux/db node)\n   '{:find [id]\n     :where [[e :crux.db/id id]]\n     :full-results? true}))
1580945229017:(full-query crux)
1580945252655:(crux/history-descending (crux/db crux)\n                           (crux/new-snapshot (crux/db crux))\n                           :person/kaarlang)
